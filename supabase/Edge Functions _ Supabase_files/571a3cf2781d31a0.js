;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="12a88155-3f4a-d931-cae8-e9f849fec1c6")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,105161,e=>{"use strict";var t=e.i(478902),n=e.i(902858),a=e.i(389959),r=e.i(355901);e.i(128328);var s=e.i(86086),i=e.i(158639),l=e.i(532728),o=e.i(967052),d=e.i(708636),c=e.i(215261),h=e.i(408891),u=e.i(97429),m=e.i(657588),p=e.i(242882),x=e.i(234745),g=e.i(741391);let j=e=>["projects",e,"log-drains"];async function f({ref:e},t){if(!e)throw Error("ref is required");let{data:n,error:a}=await (0,x.get)("/platform/projects/{ref}/analytics/log-drains",{params:{path:{ref:e}},signal:t});return a&&(0,x.handleError)(a),n}let y=({ref:e},{enabled:t=!0,...n}={})=>(0,p.useQuery)({queryKey:j(e),queryFn:({signal:t})=>f({ref:e},t),enabled:t&&!!e,refetchOnMount:!1,retry:(e,t)=>!(500===t.code||t.message.includes("API error happened"))&&e<g.MAX_RETRY_FAILURE_COUNT,...n});var v=e.i(10429),b=e.i(837710),_=e.i(843778),N=e.i(428353),S=e.i(24315),w=e.i(61863),C=e.i(191209),k=e.i(837243),T=e.i(846887),L=e.i(378277),z=e.i(449696),D=e.i(449123),F=e.i(451031),I=e.i(57492),R=e.i(831927),P=e.i(822037),A=e.i(156722),E=e.i(719754),O=e.i(725137),M=e.i(290811),U=e.i(538482),G=e.i(252387),H=e.i(713629),q=e.i(223173);let V="log-drain-destination-form",B=u.z.discriminatedUnion("type",[u.z.object({type:u.z.literal("webhook"),url:u.z.string().regex((0,H.urlRegex)(),"Endpoint URL is required and must be a valid URL").refine(e=>e.startsWith("http://")||e.startsWith("https://"),"Endpoint URL must start with http:// or https://"),http:u.z.enum(["http1","http2"]),gzip:u.z.boolean(),headers:u.z.record(u.z.string(),u.z.string()).optional()}),u.z.object({type:u.z.literal("datadog"),api_key:u.z.string().min(1,{message:"API key is required"}),region:u.z.string().min(1,{message:"Region is required"})}),u.z.object({type:u.z.literal("loki"),url:u.z.string().min(1,{message:"Loki URL is required"}).refine(e=>e.startsWith("http://")||e.startsWith("https://"),"Loki URL must start with http:// or https://"),headers:u.z.record(u.z.string(),u.z.string()),username:u.z.string().optional(),password:u.z.string().optional()}),u.z.object({type:u.z.literal("elastic")}),u.z.object({type:u.z.literal("postgres")}),u.z.object({type:u.z.literal("bigquery")}),u.z.object({type:u.z.literal("clickhouse")}),u.z.object({type:u.z.literal("s3")}),u.z.object({type:u.z.literal("axiom")}),u.z.object({type:u.z.literal("sentry"),dsn:u.z.string().min(1,{message:"Sentry DSN is required"}).refine(e=>e.startsWith("https://"),"Sentry DSN must start with https://")})]),$=u.z.object({name:u.z.string().min(1,{message:"Destination name is required"}),description:u.z.string().optional()}).and(B);function Y({value:e,label:n,description:a,formControl:r,placeholder:s,type:i,defaultValue:l}){return(0,t.jsx)(w.FormField_Shadcn_,{name:e,control:r,render:({field:e})=>(0,t.jsx)(U.FormItemLayout,{layout:"horizontal",label:n,description:a||"",children:(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsx)(L.Input_Shadcn_,{defaultValue:l,type:i||"text",placeholder:s,...e})})})})}function W({open:e,onOpenChange:n,defaultValues:u,onSubmit:p,isLoading:x,mode:g}){let j=u?.config||{},f="create"===g?{"Content-Type":"application/json"}:j?.headers||{},H=(0,m.useFlag)("SentryLogDrain"),{ref:B}=(0,i.useParams)(),{data:W}=y({ref:B}),K=u?.type||"webhook",[Q,X]=(0,a.useState)({name:"",value:""}),J=(0,o.useTrack)(),Z=(0,h.useForm)({resolver:(0,l.zodResolver)($),values:{name:u?.name||"",description:u?.description||"",type:K,http:j?.http||"http2",gzip:"create"===g||j?.gzip||!1,headers:f,url:j?.url||"",api_key:j?.api_key||"",region:j?.region||"",username:j?.username||"",password:j?.password||"",dsn:j?.dsn||""}}),ee=Z.watch("headers"),et=Z.watch("type"),en=Object.keys(ee||{})?.length>0;return(0,a.useEffect)(()=>{"create"!==g||e||Z.reset()},[g,e,Z]),(0,t.jsx)(O.Sheet,{open:e,onOpenChange:e=>{X({name:"",value:""}),n(e)},children:(0,t.jsxs)(O.SheetContent,{tabIndex:void 0,showClose:!1,size:"lg",className:"overflow-y-auto flex flex-col",children:[(0,t.jsx)(O.SheetHeader,{children:(0,t.jsx)(O.SheetTitle,{children:"Add destination"})}),(0,t.jsxs)(O.SheetSection,{className:"!px-0 !pb-0",children:[(0,t.jsx)(N.Form_Shadcn_,{...Z,children:(0,t.jsxs)("form",{id:V,onSubmit:e=>{e.preventDefault();let t=Z.getValues("name");W?.length&&W?.find(e=>e.name===t)&&"create"===g?r.toast.error("Log drain name already exists"):(Z.handleSubmit(p)(e),J("log_drain_save_button_clicked",{destination:Z.getValues("type")}))},children:[(0,t.jsxs)("div",{className:"space-y-8 px-content",children:[(0,t.jsx)(Y,{value:"name",placeholder:"My Destination",label:"Name",formControl:Z.control}),(0,t.jsx)(Y,{value:"description",placeholder:"Optional description",label:"Description",formControl:Z.control}),"create"===g&&(0,t.jsx)(U.FormItemLayout,{layout:"horizontal",label:"Type",description:q.LOG_DRAIN_TYPES.find(e=>e.value===et)?.description||"",children:(0,t.jsxs)(D.Select_Shadcn_,{defaultValue:K,value:Z.getValues("type"),onValueChange:e=>Z.setValue("type",e),children:[(0,t.jsx)(A.SelectTrigger_Shadcn_,{children:q.LOG_DRAIN_TYPES.find(e=>e.value===et)?.name}),(0,t.jsx)(F.SelectContent_Shadcn_,{children:q.LOG_DRAIN_TYPES.filter(e=>"sentry"!==e.value||H).map(e=>(0,t.jsx)(R.SelectItem_Shadcn_,{value:e.value,id:e.value,className:"text-left",children:e.name},e.value))})]})})]}),(0,t.jsxs)("div",{className:"space-y-8 mt-4",children:["webhook"===et&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"px-content space-y-8",children:[(0,t.jsx)(Y,{value:"url",label:"Endpoint URL",formControl:Z.control,placeholder:"https://example.com/log-drain"}),(0,t.jsx)(w.FormField_Shadcn_,{control:Z.control,name:"http",render:({field:e})=>(0,t.jsx)(U.FormItemLayout,{layout:"horizontal",label:"HTTP Version",children:(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsxs)(z.RadioGroupCard,{className:"flex gap-2",onValueChange:e.onChange,value:e.value,children:[(0,t.jsx)(C.FormItem_Shadcn_,{asChild:!0,children:(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsx)(z.RadioGroupCardItem,{value:"http1",label:"HTTP/1"})})}),(0,t.jsx)(C.FormItem_Shadcn_,{asChild:!0,children:(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsx)(z.RadioGroupCardItem,{value:"http2",label:"HTTP/2"})})})]})})})})]}),(0,t.jsx)(w.FormField_Shadcn_,{control:Z.control,name:"gzip",render:({field:e})=>(0,t.jsx)(C.FormItem_Shadcn_,{className:"space-y-2 px-4",children:(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsx)(M.Switch,{checked:e.value,onCheckedChange:e.onChange})}),(0,t.jsx)(k.FormLabel_Shadcn_,{className:"text-base",children:"Gzip"}),(0,t.jsx)(G.InfoTooltip,{align:"start",children:"Gzip compresses logs before sending it to the destination."})]})})})]}),"datadog"===et&&(0,t.jsxs)("div",{className:"grid gap-4 px-content",children:[(0,t.jsx)(Y,{type:"password",value:"api_key",label:"API Key",formControl:Z.control,description:(0,t.jsxs)(t.Fragment,{children:["The API Key obtained from the Datadog dashboard"," ",(0,t.jsx)("a",{target:"_blank",rel:"noopener noreferrer",className:"text-sm underline transition hover:text-foreground",href:"https://app.datadoghq.com/organization-settings/api-keys",children:"here"})]})}),(0,t.jsx)(w.FormField_Shadcn_,{name:"region",control:Z.control,render:({field:e})=>(0,t.jsx)(U.FormItemLayout,{layout:"horizontal",label:"Region",description:(0,t.jsxs)("p",{children:["The Datadog region to send logs to. Read more about Datadog regions"," ",(0,t.jsx)("a",{target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-foreground transition",href:"https://docs.datadoghq.com/getting_started/site/#access-the-datadog-site",children:"here"}),"."]}),children:(0,t.jsx)(S.FormControl_Shadcn_,{children:(0,t.jsxs)(D.Select_Shadcn_,{value:e.value,onValueChange:e.onChange,children:[(0,t.jsx)(A.SelectTrigger_Shadcn_,{className:"col-span-3",children:(0,t.jsx)(E.SelectValue_Shadcn_,{placeholder:"Select a region"})}),(0,t.jsx)(F.SelectContent_Shadcn_,{children:(0,t.jsxs)(I.SelectGroup_Shadcn_,{children:[(0,t.jsx)(P.SelectLabel_Shadcn_,{children:"Region"}),q.DATADOG_REGIONS.map(e=>(0,t.jsx)(R.SelectItem_Shadcn_,{value:e.value,children:e.label},e.value))]})})]})})})})]}),"loki"===et&&(0,t.jsxs)("div",{className:"grid gap-4 px-content",children:[(0,t.jsx)(Y,{type:"url",value:"url",placeholder:"https://my-logs-endpoint.grafana.net/loki/api/v1/push",label:"Loki URL",formControl:Z.control,description:"The Loki HTTP(S) endpoint to send events."}),(0,t.jsx)(Y,{value:"username",label:"Username",placeholder:"123456789",formControl:Z.control}),(0,t.jsx)(Y,{type:"password",value:"password",label:"Password",placeholder:"glc_ABCD1234567890",formControl:Z.control})]}),"sentry"===et&&(0,t.jsx)("div",{className:"grid gap-4 px-content",children:(0,t.jsx)(Y,{type:"text",value:"dsn",label:"DSN",placeholder:"https://<project_id>@o<organization_id>.ingest.sentry.io/<project_id>",formControl:Z.control,description:(0,t.jsxs)(t.Fragment,{children:["The DSN obtained from the Sentry dashboard. Read more about DSNs"," ",(0,t.jsx)("a",{target:"_blank",rel:"noopener noreferrer",className:"text-sm underline transition hover:text-foreground",href:"https://docs.sentry.io/concepts/key-terms/dsn-explainer/",children:"here"}),"."]})})}),(0,t.jsx)(T.FormMessage_Shadcn_,{})]})]})}),("webhook"===et||"loki"===et)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"border-t mt-4",children:[(0,t.jsxs)("div",{className:"px-content pt-2 pb-3 border-b bg-background-alternative-200",children:[(0,t.jsx)("h2",{className:"text-sm",children:"Custom Headers"}),(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"webhook"===et?"Set custom headers when draining logs to the Endpoint URL":"loki"===et?"Set custom headers when draining logs to the Loki HTTP(S) endpoint":""})]}),(0,t.jsx)("div",{className:"divide-y",children:en&&Object.keys(ee||{})?.map(e=>(0,t.jsxs)("div",{className:"flex text-sm px-content text-foreground items-center font-mono py-1.5 group",children:[(0,t.jsx)("div",{className:"w-full",children:e}),(0,t.jsx)("div",{className:"w-full truncate",title:ee?.[e],children:ee?.[e]}),(0,t.jsx)(b.Button,{className:"justify-self-end opacity-0 group-hover:opacity-100 w-7",type:"text",title:"Remove",icon:(0,t.jsx)(d.TrashIcon,{}),onClick:()=>{let t;return t={...ee},void(delete t[e],Z.setValue("headers",t))}})]},e))})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),function(){let e=Z.getValues("headers");if(!e)return;let t=Object.keys(e);t?.length===20?r.toast.error("You can only have 20 custom headers"):t?.includes(Q.name)?r.toast.error("Header name already exists"):Q.name&&Q.value?(Z.setValue("headers",{...e,[Q.name]:Q.value}),X({name:"",value:""})):r.toast.error("Header name and value are required")}()},className:"flex border-t py-4 gap-4 items-center px-content",children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:"header-name",children:"Header name"}),(0,t.jsx)(L.Input_Shadcn_,{id:"header-name",type:"text",placeholder:"x-header-name",value:Q.name,onChange:e=>X({...Q,name:e.target.value})}),(0,t.jsx)("label",{className:"sr-only",htmlFor:"header-value",children:"Header value"}),(0,t.jsx)(L.Input_Shadcn_,{id:"header-value",type:"text",placeholder:"Header value",value:Q.value,onChange:e=>X({...Q,value:e.target.value})}),(0,t.jsx)(b.Button,{htmlType:"submit",type:"outline",children:"Add"})]})]})]}),(0,t.jsxs)("div",{className:"mt-auto",children:[(0,t.jsx)(O.SheetSection,{className:(0,_.cn)(`border-t bg-background-alternative-200 mt-auto py-1.5 ${!s.IS_PLATFORM&&"hidden"}`),children:(0,t.jsxs)("ul",{className:"text-right text-foreground-light divide-y divide-dashed text-sm",children:[(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2 py-2",translate:"no",children:[(0,t.jsx)("span",{className:"text-foreground-lighter",children:"Additional drain cost"}),(0,t.jsx)("span",{className:"text-foreground",children:"$60 per month"})]}),(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2 py-2",translate:"no",children:[(0,t.jsx)("span",{className:"text-foreground-lighter",children:"Per million events"}),(0,t.jsx)("span",{children:"+$0.20"})]}),(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2 py-2",translate:"no",children:[(0,t.jsx)("span",{className:"text-foreground-lighter",children:"Per GB egress"}),(0,t.jsx)("span",{children:"+$0.09"})]})]})}),(0,t.jsxs)(O.SheetFooter,{className:"p-content !mt-0 !justify-between !flex-row w-full items-center",children:[(0,t.jsxs)("span",{className:"text-sm text-foreground-light",children:[(0,t.jsx)("span",{children:"See full pricing breakdown"})," ",(0,t.jsx)(c.default,{href:`${v.DOCS_URL}/guides/platform/manage-your-usage/log-drains`,target:"_blank",className:"text-foreground underline underline-offset-2 decoration-foreground-muted hover:decoration-foreground transition-all",children:"here"})]}),(0,t.jsx)(b.Button,{form:V,loading:x,htmlType:"submit",type:"primary",children:"Save destination"})]})]})]})})}var K=e.i(275887),Q=e.i(105356),X=e.i(567558),J=e.i(38429),Z=e.i(356003);async function ee({projectRef:e,token:t}){let{data:n,error:a}=await (0,x.del)("/platform/projects/{ref}/analytics/log-drains/{token}",{params:{path:{ref:e,token:t}}});return a&&(0,x.handleError)(a),n}var et=e.i(280590),en=e.i(627069),ea=e.i(874311),er=e.i(492418),es=e.i(466472),ei=e.i(108151);let el=({title:e,description:n,rightLabel:a,icon:r,onClick:s})=>(0,t.jsx)("button",{className:"w-full h-full text-left",onClick:s,children:(0,t.jsx)(en.Card,{className:"p-6 cursor-pointer hover:bg-surface-200 hover:border-strong transition-colors h-48",children:(0,t.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between w-full",children:[(0,t.jsx)("div",{children:r}),(0,t.jsx)("div",{className:"text-xs text-foreground-light",children:a})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h1",{className:"text-base",children:e}),(0,t.jsx)("p",{className:"text-sm text-foreground-light leading-relaxed",children:n})]})]})})});var eo=e.i(794231),ed=e.i(265100),ec=e.i(809323);e.i(481541);var eh=e.i(674742),eu=e.i(843819),em=e.i(928253),ep=e.i(993032);let ex=()=>{let[e,n]=(0,a.useState)(0),r=[{id:"datadog",name:"Datadog",icon:(0,t.jsx)(eh.Datadog,{fill:"currentColor",strokeWidth:0,size:36})},{id:"loki",name:"Loki",icon:(0,t.jsx)(eu.Grafana,{fill:"currentColor",strokeWidth:0,size:36})},{id:"https",name:"HTTPS",icon:(0,t.jsx)(ep.BracesIcon,{size:36})},{id:"sentry",name:"Sentry",icon:(0,t.jsx)(em.Sentry,{fill:"currentColor",strokeWidth:0,size:36})}];(0,a.useEffect)(()=>{let e=setInterval(()=>{n(e=>(e+1)%r.length)},2500);return()=>clearInterval(e)},[r.length]);let s=()=>(e-1+r.length)%r.length,i=()=>(e+1)%r.length,l={hidden:{x:"calc(-50% + 120px)",y:"-50%",scale:.6,opacity:0,filter:"blur(1px)"},right:{x:"calc(-50% + 80px)",y:"-50%",scale:.8,opacity:.5,zIndex:2,filter:"blur(1px)"},center:{x:"-50%",y:"-50%",scale:1,opacity:1,zIndex:3,filter:"blur(0px)"},left:{x:"calc(-50% - 80px)",y:"-50%",scale:.8,opacity:.5,zIndex:2,filter:"blur(1px)"},exit:{x:"calc(-50% - 120px)",y:"-50%",scale:.6,opacity:0,filter:"blur(1px)"}},o=[s(),e,i()];return(0,t.jsxs)("div",{className:"relative w-48 h-32 mx-auto mb-8 overflow-hidden",children:[(0,t.jsx)(ec.AnimatePresence,{initial:!1,children:r.map((n,a)=>{if(!o.includes(a))return null;let r=a===e?"center":a===s()?"left":a===i()?"right":"hidden",d=a===e;return(0,t.jsx)(ed.motion.div,{className:(0,_.cn)("absolute top-1/2 left-1/2 flex items-center justify-center rounded-lg",d?"w-24 h-24":"w-20 h-20"),variants:l,initial:"hidden",animate:r,exit:"exit",transition:{duration:.5,ease:"easeInOut"},children:(0,t.jsx)("span",{children:n.icon})},n.id)})}),(0,t.jsx)("div",{className:"absolute -inset-4 bg-gradient-to-r from-background-surface-75 via-transparent to-background-surface-75 z-40"})]})},eg=()=>(0,t.jsx)("div",{className:"flex items-center justify-center gap-1.5 text-sm",children:(0,t.jsxs)("p",{className:"text-foreground-light",children:["Don't see your preferred drain?"," ",(0,t.jsx)(c.default,{href:"https://github.com/orgs/supabase/discussions/28324?sort=top",className:"text-foreground underline underline-offset-2 decoration-foreground-muted hover:decoration-foreground transition-all",target:"_blank",children:"Vote here"})]})}),ej=()=>{let e=[{step:1,title:"Pricing",description:"Log Drains are available as a project Add-On for all Team and Enterprise users. Each Log Drain costs $60 per month.",label:"See our pricing",link:`${v.DOCS_URL}/guides/platform/manage-your-usage/log-drains`},{step:2,title:"Connect to your drain",description:"We offer support for multiple destinations including Datadog, Loki, Sentry or a custom endpoint.",label:"Read our documentation",link:`${v.DOCS_URL}/guides/telemetry/log-drains`}].filter(e=>s.IS_PLATFORM||"Pricing"!==e.title);return(0,t.jsx)("div",{className:"flex grow h-full",children:(0,t.jsx)("div",{className:"flex grow items-center justify-center p-12 @container",children:(0,t.jsxs)("div",{className:"w-full max-w-4xl flex flex-col items-center gap-0",children:[(0,t.jsxs)("div",{className:"text-center mb-12",children:[(0,t.jsx)(ex,{}),(0,t.jsx)("h2",{className:"heading-section mb-1",children:"Capture your logs, your way"}),(0,t.jsx)("p",{className:"text-foreground-light mb-6",children:"Upgrade to a Team or Enterprise Plan to send your logs to your preferred platform"}),(0,t.jsx)(eo.UpgradePlanButton,{plan:"Team",source:"log-drains-empty-state",featureProposition:"use Log Drains"})]}),(0,t.jsx)(en.Card,{className:(0,_.cn)("grid grid-cols-1 bg divide-x mb-8",s.IS_PLATFORM&&"@xl:grid-cols-2"),children:e.map((e,n)=>(0,t.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:(0,_.cn)("text-xs shrink-0 font-mono text-foreground-light w-7 h-7 bg border flex items-center justify-center rounded-md",!s.IS_PLATFORM&&"hidden"),children:e.step}),(0,t.jsx)("h3",{className:"heading-default",children:e.title})]}),(0,t.jsx)("p",{className:"text-foreground-light text-sm mb-4 flex-1",children:e.description}),(0,t.jsx)(b.Button,{type:"default",className:"w-full",asChild:!0,children:(0,t.jsx)(c.default,{href:e.link,target:"_blank",children:e.label})})]},n))}),(0,t.jsx)(eg,{})]})})})};function ef({onNewDrainClick:e,onUpdateDrainClick:n}){let{hasAccess:l,isLoading:c}=(0,et.useCheckEntitlements)("log_drains"),h=(0,o.useTrack)(),[u,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),{ref:f}=(0,i.useParams)(),{data:v,isPending:N,refetch:S,error:w,isError:C}=y({ref:f},{enabled:l}),k=(0,m.useFlag)("SentryLogDrain"),T=!!v?.length,{mutate:L}=(({onSuccess:e,onError:t,...n}={})=>{let a=(0,Z.useQueryClient)();return(0,J.useMutation)({mutationFn:e=>ee(e),async onSuccess(t,n,r){let{projectRef:s}=n;await a.invalidateQueries({queryKey:j(s)}),await e?.(t,n,r)},async onError(e,n,a){void 0===t?r.toast.error(`Failed to mutate: ${e.message}`):t(e,n,a)},...n})})({onSuccess:()=>{p(!1),g(null)},onError:()=>{p(!1),g(null),r.toast.error("Failed to delete log drain")}});return N||c?(0,t.jsx)("div",{children:(0,t.jsx)(ei.GenericSkeletonLoader,{})}):c||l?C?(0,t.jsx)(X.default,{subject:"Failed to load log drains",error:w}):N||T?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(en.Card,{children:(0,t.jsxs)(er.Table,{children:[(0,t.jsx)(er.TableHeader,{children:(0,t.jsxs)(er.TableRow,{children:[(0,t.jsx)(er.TableHead,{className:"max-w-[200px]",children:"Name"}),(0,t.jsx)(er.TableHead,{className:"w-96",children:"Description"}),(0,t.jsx)(er.TableHead,{className:"w-48",children:"Destination"}),(0,t.jsx)(er.TableHead,{className:"text-right",children:(0,t.jsx)("div",{className:"sr-only",children:"Actions"})})]})}),(0,t.jsx)(er.TableBody,{children:v?.slice().sort((e,t)=>t.id-e.id).map(e=>(0,t.jsxs)(er.TableRow,{children:[(0,t.jsx)(er.TableCell,{className:"font-medium truncate max-w-72",title:e.name,children:e.name}),(0,t.jsx)(er.TableCell,{className:(0,_.cn)("truncate max-w-96",e.description?"text-foreground-light":"text-foreground-muted"),title:e.description,children:e.description||"-"}),(0,t.jsx)(er.TableCell,{className:"text-foreground-light",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[a.default.cloneElement(q.LOG_DRAIN_TYPES.find(t=>t.value===e.type)?.icon,{width:16,height:16}),(0,t.jsx)("span",{className:"truncate max-w-40",children:q.LOG_DRAIN_TYPES.find(t=>t.value===e.type)?.name})]})}),(0,t.jsx)(er.TableCell,{className:"text-right",children:(0,t.jsxs)(ea.DropdownMenu,{children:[(0,t.jsx)(ea.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{type:"text",className:"px-1 opacity-50 hover:opacity-100 !bg-transparent flex-shrink-0",icon:(0,t.jsx)(K.MoreHorizontal,{})})}),(0,t.jsxs)(ea.DropdownMenuContent,{className:"max-w-[140px]",align:"end",children:[(0,t.jsxs)(ea.DropdownMenuItem,{onClick:()=>{n(e)},children:[(0,t.jsx)(Q.Pencil,{className:"h-4 w-4 mr-2"}),"Update"]}),(0,t.jsxs)(ea.DropdownMenuItem,{onClick:()=>{g(e),p(!0)},children:[(0,t.jsx)(d.TrashIcon,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))}),(0,t.jsx)(es.default,{confirmLabel:"Delete",variant:"destructive",title:"Delete Log Drain",visible:u,onConfirm:()=>{x&&f&&(L({token:x.token,projectRef:f}),h("log_drain_confirm_button_submitted",{destination:x.type}))},onCancel:()=>p(!1),children:(0,t.jsxs)("div",{className:"text-foreground-light text-sm",children:[(0,t.jsxs)("p",{children:["Are you sure you want to delete"," ",(0,t.jsx)("span",{className:"text-foreground",children:x?.name}),"?"]}),(0,t.jsx)("p",{children:"This action cannot be undone."})]})})]})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid lg:grid-cols-2 gap-4",children:q.LOG_DRAIN_TYPES.filter(e=>"sentry"!==e.value||k).map(n=>(0,t.jsx)(el,{title:n.name,description:n.description,icon:n.icon,rightLabel:s.IS_PLATFORM?"Additional $60":void 0,onClick:()=>{e(n.value)}},n.value))}),(0,t.jsx)(eg,{})]}):(0,t.jsx)(ej,{})}var ey=e.i(448710),ev=e.i(79771),eb=e.i(865389),e_=e.i(167892),eN=e.i(513826);async function eS(e){let{data:t,error:n}=await (0,x.post)("/platform/projects/{ref}/analytics/log-drains",{params:{path:{ref:e.projectRef}},body:{name:e.name,description:e.description,type:e.type,config:e.config}});return n&&(0,x.handleError)(n),t}async function ew(e){if(!e.token)throw Error("Token is required");let{data:t,error:n}=await (0,x.put)("/platform/projects/{ref}/analytics/log-drains/{token}",{params:{path:{ref:e.projectRef,token:e.token}},body:{name:e.name,description:e.description,type:e.type,config:e.config}});return n&&(0,x.handleError)(n),t}var eC=e.i(2579),ek=e.i(88816),eT=e.i(178527);let eL=()=>{let{can:e,isLoading:l}=(0,eC.useAsyncCheckPermissions)(n.PermissionAction.ANALYTICS_ADMIN_WRITE,"logflare"),[o,d]=(0,a.useState)(!1),{ref:c}=(0,i.useParams)(),[h,u]=(0,a.useState)(null),[m,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),[f,_]=(0,a.useState)("create"),{hasAccess:N,isLoading:S}=(0,et.useCheckEntitlements)("log_drains"),{data:w}=y({ref:c},{enabled:!S&&N}),{mutate:C,isPending:k}=(({onSuccess:e,onError:t,...n}={})=>{let a=(0,Z.useQueryClient)();return(0,J.useMutation)({mutationFn:e=>eS(e),async onSuccess(t,n,r){let{projectRef:s}=n;await a.invalidateQueries({queryKey:j(s)}),await e?.(t,n,r)},async onError(e,n,a){void 0===t?r.toast.error(`Failed to mutate: ${e.message}`):t(e,n,a)},...n})})({onSuccess:()=>{r.toast.success("Log drain destination created"),d(!1)},onError:()=>{r.toast.error("Failed to create log drain"),d(!1)}}),{mutate:T,isPending:L}=(({onSuccess:e,onError:t,...n}={})=>{let a=(0,Z.useQueryClient)();return(0,J.useMutation)({mutationFn:e=>ew(e),async onSuccess(t,n,r){let{projectRef:s}=n;await a.invalidateQueries({queryKey:j(s)}),await e?.(t,n,r)},async onError(e,n,a){void 0===t?r.toast.error(`Failed to mutate: ${e.message}`):t(e,n,a)},...n})})({onSuccess:()=>{r.toast.success("Log drain updated"),d(!1)},onError:()=>{d(!1),r.toast.error("Failed to update log drain")}});function z(e){u({type:e}),_("create"),d(!0)}let D=(0,t.jsxs)(e_.ScaffoldSection,{isFullWidth:!0,id:"log-drains",className:"gap-6",children:[(0,t.jsxs)(e_.ScaffoldContainer,{className:"flex flex-col gap-10",bottomPadding:!0,children:[(0,t.jsx)(W,{mode:f,open:o,onOpenChange:e=>{e||u(null),d(e)},defaultValues:{type:h?.type||"webhook",...h},isLoading:k||L,onSubmit:({name:e,description:t,type:n,...a})=>{let r={name:e,description:t||"",type:n,config:a,id:h?.id,projectRef:c,token:h?.token};if("create"===f)g(r),p(!0);else if(r.id&&h?.token)T(r);else throw Error("Log drain ID and token is required")}}),l?(0,t.jsx)(ei.GenericSkeletonLoader,{}):e?(0,t.jsx)(ef,{onUpdateDrainClick:function(e){u(e),_("update"),d(!0)},onNewDrainClick:z}):(0,t.jsx)(eT.Alert_Shadcn_,{variant:"default",children:"You do not have permission to manage log drains"})]}),(0,t.jsx)(es.default,{confirmLabel:"Add destination",variant:"default",title:"Confirm Log Drain Creation",visible:m,onConfirm:()=>{x&&(C(x),g(null)),p(!1),d(!1)},onCancel:()=>{p(!1),g(null)},children:(0,t.jsxs)("div",{className:"text-foreground-light text-sm space-y-2",children:[(0,t.jsxs)("p",{children:["You are about to create a new log drain destination:"," ",(0,t.jsx)("span",{className:"text-foreground",children:x?.name})]}),s.IS_PLATFORM&&(0,t.jsxs)("p",{children:["This will incur an additional ",(0,t.jsx)("span",{className:"text-foreground",children:"$60 per month"})," ","charge to your subscription."]}),(0,t.jsx)("p",{children:"Are you sure you want to proceed?"})]})})]});return!S&&N?(0,t.jsx)(ev.PageLayout,{title:"Log Drains",subtitle:"Send your project logs to third party destinations",primaryActions:(0,t.jsx)(t.Fragment,{children:w?.length!==0&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(b.Button,{disabled:!N||!e,onClick:()=>{u(null),_("create"),d(!0)},type:"primary",className:"rounded-r-none px-3",children:"Add destination"}),(0,t.jsxs)(ea.DropdownMenu,{children:[(0,t.jsx)(ea.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{type:"primary",title:"Choose token scope",className:"rounded-l-none px-[4px] py-[5px]",icon:(0,t.jsx)(ek.ChevronDown,{})})}),(0,t.jsx)(ea.DropdownMenuContent,{align:"end",side:"bottom",children:q.LOG_DRAIN_TYPES.map(e=>(0,t.jsx)(ea.DropdownMenuItem,{onClick:()=>z(e.value),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.cloneElement)(e.icon,{height:16,width:16}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"block text-foreground",children:e.name}),s.IS_PLATFORM&&(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Additional $60"})]})]})},e.value))})]})]})}),secondaryActions:(0,t.jsx)(eN.DocsButton,{href:`${v.DOCS_URL}/guides/platform/log-drains`}),children:D}):D};eL.getLayout=e=>(0,t.jsx)(ey.default,{children:(0,t.jsx)(eb.default,{title:"Log Drains",children:e})}),e.s(["default",0,eL],105161)},179,(e,t,n)=>{let a="/project/[ref]/settings/log-drains";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(105161)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})}]);

//# debugId=12a88155-3f4a-d931-cae8-e9f849fec1c6
//# sourceMappingURL=799bf3ef9464963d.js.map