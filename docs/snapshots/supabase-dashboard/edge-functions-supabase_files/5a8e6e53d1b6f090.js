;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="ad6f93fa-9bdf-cdfa-aa3c-700a3ad37772")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,822923,e=>{"use strict";var s=e.i(478902),i=e.i(902858);e.i(128328);var t=e.i(158639),r=e.i(17203),a=e.i(947748),l=e.i(644087),n=e.i(937942),o=e.i(627069),c=e.i(479095),d=e.i(492418),u=e.i(196621),p=e.i(356003),h=e.i(543851),m=e.i(890054),x=e.i(389959),y=e.i(355901),j=e.i(416144),g=e.i(223600),f=e.i(242882),b=e.i(234745),k=e.i(348682);async function w({projectRef:e,id:s,reveal:i},t){if(void 0===e)throw Error("projectRef is required");if(void 0===s)throw Error("Content ID is required");let{data:r,error:a}=await (0,b.get)("/v1/projects/{ref}/api-keys/{id}",{params:{path:{ref:e,id:s},query:{reveal:i}},signal:t});return a&&(0,b.handleError)(a),r}var v=e.i(2579),P=e.i(837710),A=e.i(843778),N=e.i(613580);function S({apiKey:e}){let r=(0,p.useQueryClient)(),{ref:a}=(0,t.useParams)(),[l,n]=(0,x.useState)(!1),o="secret"===e.type,{can:c,isLoading:d}=(0,v.useAsyncCheckPermissions)(i.PermissionAction.READ,"service_api_keys"),{data:u,error:b,isPending:S,refetch:T}=(({projectRef:e,id:s,reveal:i},{enabled:t=!0,...r}={})=>(0,f.useQuery)({queryKey:k.apiKeysKeys.single(e,s),queryFn:({signal:t})=>w({projectRef:e,id:s,reveal:i},t),enabled:t&&void 0!==e&&void 0!==s,...r}))({projectRef:a,id:e.id,reveal:!0},{enabled:l,staleTime:0,gcTime:0});async function _(){o&&!c||d||n(!l)}async function I(){if(u?.api_key)return u?.api_key??"";try{let s=await T();if(r.removeQueries({queryKey:k.apiKeysKeys.single(a,e.id),exact:!0}),s.isSuccess)return s.data.api_key??"";if(b)return y.toast.error("Failed to copy secret API key"),""}catch(e){return console.error("Failed to fetch API key:",e),""}return e.api_key}(0,x.useEffect)(()=>{if(l&&u?.api_key){let s=setTimeout(()=>{n(!1),r.removeQueries({queryKey:k.apiKeysKeys.single(a,e.id),exact:!0})},1e4);return()=>clearTimeout(s)}},[l,u?.api_key,a,r,e.id]);let C=o&&!c;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:(0,A.cn)((0,j.InputVariants)({size:"tiny"}),"w-[100px] sm:w-[140px] md:w-[180px] lg:w-[340px] gap-0 font-mono rounded-full",o?"overflow-hidden":"",l?"ring-1 ring-foreground-lighter ring-opacity-50":"ring-0 ring-opacity-0","transition-all cursor-text relative"),style:{userSelect:"all"},children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:e?.api_key.slice(0,15)}),(0,s.jsx)("span",{children:l&&u?.api_key?u?.api_key.slice(15):"••••••••••••••••"})]}):(0,s.jsx)("span",{title:e.api_key,className:"truncate",children:e.api_key})}),o&&(0,s.jsxs)(N.Tooltip,{children:[(0,s.jsx)(N.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(P.Button,{type:"outline",className:"rounded-full px-2 pointer-events-auto",loading:l&&S,icon:l?(0,s.jsx)(m.EyeOff,{strokeWidth:2}):(0,s.jsx)(h.Eye,{strokeWidth:2}),onClick:_,disabled:C})}),(0,s.jsx)(N.TooltipContent,{side:"bottom",children:C?"You need additional permissions to reveal secret API keys":d?"Loading permissions...":l?"Hide API key":"Reveal API key"})]}),(0,s.jsxs)(N.Tooltip,{children:[(0,s.jsx)(N.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(g.default,{type:"default",asyncText:I,iconOnly:!0,className:"rounded-full px-2 pointer-events-auto",disabled:C||d})}),(0,s.jsx)(N.TooltipContent,{side:"bottom",children:C?"You need additional permissions to copy secret API keys":d?"Loading permissions...":"Copy API key"})]})]})}var T=e.i(38429);async function _(e){if(!e.projectRef)throw Error("projectRef is required");let{data:s,error:i}=await (0,b.post)("/v1/projects/{ref}/api-keys",{params:{path:{ref:e.projectRef},query:{reveal:!1}},body:{..."secret"===e.type?{secret_jwt_template:{role:"service_role"}}:name,type:e.type,name:e.name,description:e.description||null}});return i&&(0,b.handleError)(i),s}let I=({onSuccess:e,onError:s,...i}={})=>{let t=(0,p.useQueryClient)();return(0,T.useMutation)({mutationFn:e=>_(e),async onSuccess(s,i,r){let{projectRef:a}=i;await t.invalidateQueries({queryKey:k.apiKeysKeys.list(a)}),await e?.(s,i,r)},async onError(e,i,t){void 0===s?y.toast.error(`Failed to create API key: ${e.message}`):s(e,i,t)},...i})};var C=e.i(232520);let D=()=>{let{ref:e}=(0,t.useParams)(),[i,r]=(0,x.useState)(!1),[a,l]=(0,x.useState)(!1),{mutateAsync:n}=I(),o=async()=>{if(e){r(!0);try{await n({projectRef:e,type:"publishable",name:"default"}),await n({projectRef:e,type:"secret",name:"default"}),l(!1),y.toast.success("Successfully created a new set of API keys!")}catch(e){console.error("Failed to create API keys:",e)}finally{r(!1)}}};return(0,s.jsxs)(C.AlertDialog,{open:a,onOpenChange:l,children:[(0,s.jsx)(P.Button,{onClick:()=>l(!0),children:"Create new API keys"}),(0,s.jsxs)(C.AlertDialogContent,{children:[(0,s.jsxs)(C.AlertDialogHeader,{children:[(0,s.jsx)(C.AlertDialogTitle,{children:"Create new API keys"}),(0,s.jsxs)(C.AlertDialogDescription,{children:["This will create a default publishable key and a default secret key both named"," ",(0,s.jsx)("code",{className:"!break-keep text-code-inline",children:"default"}),". These keys are required to connect your application to your Supabase project."]})]}),(0,s.jsxs)(C.AlertDialogFooter,{children:[(0,s.jsx)(C.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(C.AlertDialogAction,{onClick:o,disabled:i,children:i?"Creating...":"Create keys"})]})]})]})},E=[{id:"mock-id-2",type:"publishable",api_key:"sb_publishable_ltaNA7nnVozoSCOcZIjg",name:"web"},{id:"mock-id-3",type:"publishable",api_key:"sb_publishable_YpotEpinEWsC2dI7FIKI",name:"mobile"},{id:"mock-id-1",type:"secret",api_key:"sb_secret_8I4Se•••••••••••••",name:"backend_api"}],F=()=>(0,s.jsx)(o.Card,{className:"w-full overflow-hidden opacity-60 pointer-events-none bg-surface-100",children:(0,s.jsx)(o.CardContent,{className:"p-0",children:(0,s.jsxs)(d.Table,{className:"p-5",children:[(0,s.jsx)(d.TableHeader,{children:(0,s.jsxs)(d.TableRow,{className:"bg-200",children:[(0,s.jsx)(d.TableHead,{className:"text-left font-mono uppercase text-xs text-foreground-lighter h-auto py-2 overflow-hidden w-[180px]",children:"Name"},""),(0,s.jsx)(d.TableHead,{className:"text-left font-mono uppercase text-xs text-foreground-lighter h-auto py-2 pr-0",children:"API Key"}),(0,s.jsx)(d.TableHead,{className:"text-right font-mono uppercase text-xs text-foreground-lighter h-auto py-2"},"actions")]})}),(0,s.jsx)(d.TableBody,{children:E.map(e=>(0,s.jsxs)(d.TableRow,{children:[(0,s.jsx)(d.TableCell,{className:"py-2 w-[180px]",children:e.name}),(0,s.jsx)(d.TableCell,{className:"py-2",children:(0,s.jsx)("div",{className:"flex flex-row gap-2",children:(0,s.jsx)(S,{apiKey:e})})}),(0,s.jsx)(d.TableCell,{})]},e.id))})]})})}),K=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-1/2 xl:h-full xl:inset-x-auto xl:-right-16 xl:top-3 w-full xl:w-2/3 bg-gradient-to-t xl:bg-gradient-to-l from-background-alternative via-background-alternative/90 via-[5%] to-transparent z-[3] pointer-events-none xl:max-w-[500px]"}),(0,s.jsx)("div",{className:"absolute scale-100 left-10 -bottom-14 w-[720px] xl:w-[500px] xl:left-auto xl:-right-[200px] 2xl:-right-16 xl:top-[21px] xl:scale-75",children:(0,s.jsx)(F,{})})]}),L=()=>(0,s.jsx)(l.FeatureBanner,{illustration:(0,s.jsx)(K,{}),bgAlt:!0,children:(0,s.jsxs)("div",{className:"flex flex-col gap-0 z-[2]",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Create API keys"}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter lg:max-w-sm 2xl:max-w-none",children:"Use keys to authenticate requests to your app"}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(D,{})})]})}),R=()=>(0,s.jsxs)(l.FeatureBanner,{storageKey:a.LOCAL_STORAGE_KEYS.API_KEYS_FEEDBACK_DISMISSED,className:"!p-0 flex flex-col gap-0",dismissable:!0,children:[(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Your new API keys are here"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["We've updated our API keys to better support your application needs."," ",(0,s.jsxs)(n.InlineLink,{href:"https://github.com/orgs/supabase/discussions/29260",className:"inline-flex items-center gap-1",children:["Join the discussion on GitHub ",(0,s.jsx)(r.ExternalLink,{"aria-hidden":!0,size:14,strokeWidth:1.5})]})]})]}),(0,s.jsx)(c.Separator,{className:"w-full"}),(0,s.jsx)("div",{className:"px-5 py-2 bg-surface-200/30",children:(0,s.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Having trouble with the new API keys?"," ",(0,s.jsx)(u.SupportLink,{className:n.InlineLinkClassName,queryParams:{category:i.SupportCategories.PROBLEM,subject:"Help with API keys",message:"I'm experiencing problems with the new API keys feature. Please describe your specific issue here."},children:"Contact support"})]})})]});var q=e.i(567558),O=e.i(908027),H=e.i(693241);async function M(e){if(!e.projectRef)throw Error("projectRef is required");let{data:s,error:i}=await (0,b.del)("/v1/projects/{ref}/api-keys/{id}",{params:{path:{ref:e.projectRef,id:e.id},query:{reveal:!1}}});return i&&(0,b.handleError)(i),s}let z=({onSuccess:e,onError:s,...i}={})=>{let t=(0,p.useQueryClient)();return(0,T.useMutation)({mutationFn:e=>M(e),async onSuccess(s,i,r){let{projectRef:a}=i;await t.invalidateQueries({queryKey:k.apiKeysKeys.list(a)}),await e?.(s,i,r)},async onError(e,i,t){void 0===s?y.toast.error(`Failed to delete API key: ${e.message}`):s(e,i,t)},...i})};var B=e.i(108892),Q=e.i(114378),U=e.i(710483),Y=e.i(108151),W=e.i(265100),$=e.i(471998),V=e.i(657588),G=e.i(170149),X=e.i(874311),J=e.i(955909),Z=e.i(432946),ee=e.i(423782);let es=({apiKey:e,setKeyToDelete:t})=>{let{can:r}=(0,v.useAsyncCheckPermissions)(i.PermissionAction.TENANT_SQL_ADMIN_WRITE,"*");return(0,s.jsxs)(ee.DropdownMenuItemTooltip,{className:"flex gap-2",onClick:()=>{r&&t(e.id)},disabled:!r,tooltip:{content:{side:"left",text:r?void 0:"You need additional permissions to delete API keys"}},children:[(0,s.jsx)(Z.Trash2,{size:14})," Delete API key"]})},ei=({apiKey:e,lastSeen:i,isDeleting:t,isDeleteModalOpen:r,isLoadingLastSeen:a=!1,showLastSeen:l=!0,onDelete:n,setKeyToDelete:o})=>{let c=W.motion.create(d.TableRow),u=(0,V.useFlag)("showApiKeysLastUsed");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c,{layout:!0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{type:"spring",stiffness:500,damping:50,mass:1},children:[(0,s.jsx)(d.TableCell,{className:"py-2 w-56",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:e.name}),(0,s.jsx)("div",{className:"text-sm text-foreground-lighter",children:e.description||(0,s.jsx)("span",{className:"text-foreground-muted",children:"No description"})})]})}),(0,s.jsx)(d.TableCell,{className:"py-2",children:(0,s.jsx)("div",{className:"flex flex-row gap-2",children:(0,s.jsx)(S,{apiKey:e})})}),l&&u&&(0,s.jsx)(d.TableCell,{className:"py-2 min-w-0 whitespace-nowrap hidden lg:table-cell",children:(0,s.jsx)("div",{className:"truncate",title:i?.timestamp.toString()||"Never used",children:a?(0,s.jsx)(Y.ShimmeringLoader,{}):i?.timestamp?(0,s.jsx)(J.TimestampInfo,{className:"text-sm",utcTimestamp:i?.timestamp,label:i.relative}):(0,s.jsx)("span",{className:"text-foreground-lighter",children:"Never used"})})}),(0,s.jsx)(d.TableCell,{className:"py-2",children:(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(X.DropdownMenu,{children:[(0,s.jsx)(X.DropdownMenuTrigger,{className:"px-1 focus-visible:outline-none",asChild:!0,children:(0,s.jsx)(P.Button,{type:"text",size:"tiny",icon:(0,s.jsx)($.MoreVertical,{size:"14",className:"text-foreground-light hover:text-foreground"})})}),(0,s.jsx)(X.DropdownMenuContent,{className:"max-w-40",align:"end",children:(0,s.jsx)(es,{apiKey:e,setKeyToDelete:o})})]})})})]}),(0,s.jsx)(G.TextConfirmModal,{visible:r,onCancel:()=>o(null),onConfirm:n,title:`Delete ${e.type} API key: ${e.name}`,confirmString:e.name,confirmLabel:"Yes, irreversibly delete this API key",confirmPlaceholder:"Type the name of the API key to confirm",loading:t,variant:"destructive",alert:{title:"This cannot be undone",description:i?`This API key was used ${i.timestamp}. Make sure all backend components using it have been updated. Deletion will cause them to receive HTTP 401 Unauthorized status codes on all Supabase APIs.`:"This API key has not been used in the past 24 hours. Make sure you've updated all backend components using it before deletion."}})]})};var et=e.i(532728),er=e.i(479232),ea=e.i(95051),el=e.i(4196),en=e.i(408891),eo=e.i(531837),ec=e.i(253214),ed=e.i(24315),eu=e.i(61863),ep=e.i(428353),eh=e.i(378277),em=e.i(538482);let ex="create-publishable-api-key",ey=eo.object({name:eo.string(),description:eo.string().trim()}),ej=()=>{let e=(0,ea.useParams)(),i=e?.ref,[t,r]=(0,el.useQueryState)("new",el.parseAsString.withDefault("").withOptions({history:"push",clearOnDefault:!0})),a=e=>{e?r("publishable"):r("")},l={name:"",description:""},n=(0,en.useForm)({resolver:(0,et.zodResolver)(ey),defaultValues:{name:"",description:""}}),{mutate:o,isPending:c}=I(),d=async e=>{o({projectRef:i,type:"publishable",name:e.name,description:e.description},{onSuccess:()=>{n.reset(l),a(!1)}})};return(0,s.jsxs)(ec.Dialog,{open:"publishable"===t,onOpenChange:a,children:[(0,s.jsx)(ec.DialogTrigger,{asChild:!0,children:(0,s.jsx)(P.Button,{type:"default",icon:(0,s.jsx)(er.Plus,{}),children:"New publishable key"})}),(0,s.jsxs)(ec.DialogContent,{children:[(0,s.jsxs)(ec.DialogHeader,{children:[(0,s.jsx)(ec.DialogTitle,{children:"Create new publishable API key"}),(0,s.jsx)(ec.DialogDescription,{children:"Publishable API keys are used to authorize requests to your project from the web, mobile or desktop apps, CLIs or other public components of your application. They are safe to be published online and embedded in code."})]}),(0,s.jsx)(ec.DialogSectionSeparator,{}),(0,s.jsx)(ec.DialogSection,{className:"flex flex-col gap-4",children:(0,s.jsx)(ep.Form_Shadcn_,{...n,children:(0,s.jsxs)("form",{className:"flex flex-col gap-4",id:ex,onSubmit:n.handleSubmit(d),children:[(0,s.jsx)(eu.FormField_Shadcn_,{name:"name",control:n.control,render:({field:e})=>(0,s.jsx)(em.FormItemLayout,{label:"Name",description:"A short name of lowercase alphanumeric characters and underscore, must start with letter or underscore.",children:(0,s.jsx)(ed.FormControl_Shadcn_,{children:(0,s.jsx)(eh.Input_Shadcn_,{...e})})})},"name"),(0,s.jsx)(eu.FormField_Shadcn_,{name:"description",control:n.control,render:({field:e})=>(0,s.jsx)(em.FormItemLayout,{label:"Description",description:"Provide a description about what this key is used for.",children:(0,s.jsx)(ed.FormControl_Shadcn_,{children:(0,s.jsx)(eh.Input_Shadcn_,{...e,placeholder:"(Optional)"})})})},"description")]})})}),(0,s.jsx)(ec.DialogFooter,{children:(0,s.jsx)(P.Button,{form:ex,htmlType:"submit",loading:c,children:"Create Publishable API key"})})]})]})},eg=()=>{let{ref:e}=(0,t.useParams)(),{can:r,isLoading:a}=(0,v.useAsyncCheckPermissions)(i.PermissionAction.SECRETS_READ,"*"),{data:l=[],error:n,isPending:c,isError:u}=(0,B.useAPIKeysQuery)({projectRef:e,reveal:!1},{enabled:r}),p=(0,x.useMemo)(()=>l.filter(({type:e})=>"publishable"===e||"secret"===e)??[],[l]).length>0,h=(0,x.useMemo)(()=>l?.filter(e=>"publishable"===e.type)??[],[l]),m=(0,x.useRef)(null),{value:j,setValue:g}=(0,Q.useQueryStateWithSelect)({urlKey:"deletePublishableKey",select:e=>e?h?.find(s=>s.id===e):void 0,enabled:!!h?.length,onError:(e,s)=>{(0,Q.handleErrorOnDelete)(m,s,"API Key not found")}}),{mutate:f,isPending:b}=z({onSuccess:()=>{y.toast.success("Successfully deleted publishable key"),g(null)},onError:()=>{m.current=null}});return(0,s.jsxs)("div",{children:[(0,s.jsx)(O.FormHeader,{title:"Publishable key",description:"This key is safe to use in a browser if you have enabled Row Level Security (RLS) for your tables and configured policies.",actions:(0,s.jsx)(ej,{})}),r||a?c||a?(0,s.jsx)(Y.GenericSkeletonLoader,{}):u?(0,s.jsx)(q.AlertError,{error:n,subject:"Failed to load API keys"}):(0,s.jsx)(o.Card,{className:"bg-surface-100",children:(0,s.jsxs)(d.Table,{children:[(0,s.jsx)(d.TableHeader,{children:(0,s.jsxs)(d.TableRow,{className:"bg-200",children:[(0,s.jsx)(d.TableHead,{children:"Name"}),(0,s.jsx)(d.TableHead,{children:"API Key"}),(0,s.jsx)(d.TableHead,{})]})}),(0,s.jsxs)(d.TableBody,{children:[p&&0===h.length&&(0,s.jsx)(d.TableRow,{children:(0,s.jsx)(d.TableCell,{colSpan:3,className:"p-0",children:(0,s.jsx)(U.Admonition,{showIcon:!1,type:"default",className:"border-0 rounded-none",children:(0,s.jsx)("p",{className:"text-foreground-light",children:"No publishable keys created yet"})})})}),h.map(i=>(0,s.jsx)(ei,{showLastSeen:!1,apiKey:i,isDeleting:j?.id===i.id&&b,isDeleteModalOpen:j?.id===i.id,onDelete:()=>e?i.id?void(m.current=i.id,f({projectRef:e,id:i.id})):console.error("API key ID is required"):console.error("Project ref is required"),setKeyToDelete:g},i.id))]}),(0,s.jsx)(d.TableFooter,{className:"border-t",children:(0,s.jsx)(d.TableRow,{className:"border-b-0",children:(0,s.jsx)(d.TableCell,{colSpan:3,className:"py-2",children:(0,s.jsx)("p",{className:"text-xs text-foreground-lighter font-normal",children:"Publishable keys can be safely shared publicly"})})})})]})}):(0,s.jsx)(H.NoPermission,{resourceText:"view API keys"})]})};var ef=e.i(55956),eb=e.i(924529);let ek=(0,e.i(388019).default)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var ew=e.i(178527),ev=e.i(206413),eP=e.i(592360);let eA=eo.string().min(4,"Name must be at least 4 characters").max(64,"Name can't be more than 64 characters long").regex(/^[a-z0-9_]+$/,"Name can only contain lowercased letters, digits and underscore").refine(e=>!e.match(/^[0-9].+$/),"Name must not start with a digit").refine(e=>"anon"!==e&&"service_role"!==e,'Using "anon" or "service_role" for API key name is not possible'),eN="create-secret-api-key",eS=eo.object({name:eA,description:eo.string().max(256,"Description shouldn't be too long").trim()}),eT=()=>{let{ref:e}=(0,t.useParams)(),[i,r]=(0,el.useQueryState)("new",el.parseAsString.withDefault("").withOptions({history:"push",clearOnDefault:!0})),a=e=>{e?r("secret"):r("")},l={name:"",description:""},n=(0,en.useForm)({resolver:(0,et.zodResolver)(eS),defaultValues:l}),{mutate:o,isPending:c}=I(),d=async s=>{o({projectRef:e,type:"secret",name:s.name,description:s.description},{onSuccess:e=>{y.toast.success(`Your secret API key ${e.prefix}... is ready.`),n.reset(l),a(!1)}})};return(0,s.jsxs)(ec.Dialog,{open:"secret"===i,onOpenChange:a,children:[(0,s.jsx)(ec.DialogTrigger,{asChild:!0,children:(0,s.jsx)(P.Button,{type:"default",className:"mt-2",icon:(0,s.jsx)(er.Plus,{}),children:"New secret key"})}),(0,s.jsxs)(ec.DialogContent,{children:[(0,s.jsxs)(ec.DialogHeader,{children:[(0,s.jsx)(ec.DialogTitle,{children:"Create new secret API key"}),(0,s.jsx)(ec.DialogDescription,{className:"grid gap-y-2",children:(0,s.jsx)("p",{children:"Secret API keys allow elevated access to your project's data, bypassing Row-Level security."})})]}),(0,s.jsx)(ec.DialogSectionSeparator,{}),(0,s.jsxs)(ec.DialogSection,{className:"flex flex-col gap-4",children:[(0,s.jsx)(ep.Form_Shadcn_,{...n,children:(0,s.jsxs)("form",{className:"flex flex-col gap-4",id:eN,onSubmit:n.handleSubmit(d),children:[(0,s.jsx)(eu.FormField_Shadcn_,{name:"name",control:n.control,render:({field:e})=>(0,s.jsx)(em.FormItemLayout,{label:"Name",description:"A short, unique name of lowercased letters, digits and underscore",children:(0,s.jsx)(ed.FormControl_Shadcn_,{children:(0,s.jsx)(eh.Input_Shadcn_,{...e,placeholder:"Example: my_super_secret_key_123"})})})},"name"),(0,s.jsx)(eu.FormField_Shadcn_,{name:"description",control:n.control,render:({field:e})=>(0,s.jsx)(em.FormItemLayout,{label:"Description",labelOptional:"Optional",children:(0,s.jsx)(ed.FormControl_Shadcn_,{children:(0,s.jsx)(eh.Input_Shadcn_,{...e,placeholder:"Short notes on how or where this key will be used"})})})},"description")]})}),(0,s.jsxs)(ew.Alert_Shadcn_,{variant:"warning",children:[(0,s.jsx)(ek,{}),(0,s.jsx)(eP.AlertTitle_Shadcn_,{children:"Securing your API key"}),(0,s.jsx)(ev.AlertDescription_Shadcn_,{className:"",children:(0,s.jsxs)("ul",{className:"list-disc",children:[(0,s.jsx)("li",{children:"Keep this key secret."}),(0,s.jsx)("li",{children:"Do not use on the web, in mobile or desktop apps."}),(0,s.jsx)("li",{children:"Don't post it publicly or commit in source control."}),(0,s.jsx)("li",{children:"This key provides elevated access to your data, bypassing Row-Level Security."}),(0,s.jsx)("li",{children:"If it leaks or is revealed, swap it with a new secret API key and then delete it."}),(0,s.jsx)("li",{children:"If used in a browser, it will always return HTTP 401 Unauthorized. Delete immediately."})]})})]})]}),(0,s.jsx)(ec.DialogFooter,{children:(0,s.jsx)(P.Button,{form:eN,htmlType:"submit",loading:c,children:"Create API key"})})]})]})},e_=()=>{let{ref:e}=(0,t.useParams)(),{can:r,isLoading:a}=(0,v.useAsyncCheckPermissions)(i.PermissionAction.SECRETS_READ,"*"),{data:l,error:n,isPending:c,isError:u}=(0,B.useAPIKeysQuery)({projectRef:e,reveal:!1},{enabled:r}),p=(0,V.useFlag)("showApiKeysLastUsed"),{data:h,isLoading:m}=function({projectRef:e,enabled:s}){let i=(0,x.useRef)(new Date).current,t=(0,eb.useLogsQuery)(e,{iso_timestamp_start:new Date(i.getTime()-864e5).toISOString(),iso_timestamp_end:i.toISOString(),sql:"-- last-used-secret-api-keys\nSELECT unix_millis(max(timestamp)) as timestamp, apikey.`hash` FROM edge_logs cross join unnest(metadata) as m cross join unnest(m.request) as request cross join unnest(request.sb) as sb cross join unnest(sb.apikey) as sbapikey cross join unnest(sbapikey.apikey) as apikey WHERE apikey.error is null and apikey.`hash` is not null and apikey.prefix like 'sb_secret_%' GROUP BY apikey.`hash`"},s);return(0,x.useMemo)(()=>{if(t.isLoading||!t.logData)return{data:void 0,isLoading:t.isLoading};let e=(0,ef.default)();return{data:t.logData.reduce((s,i)=>(s[i.hash]={timestamp:i.timestamp,relative:`${ef.default.duration(e.diff((0,ef.default)(i.timestamp))).humanize(!1)} ago`},s),{}),isLoading:t.isLoading}},[t])}({projectRef:e??"",enabled:p}),j=(0,x.useMemo)(()=>l?.filter(e=>"secret"===e.type)??[],[l]),g=j?.length===0&&!c&&!a,f=(0,x.useRef)(null),{setValue:b,value:k}=(0,Q.useQueryStateWithSelect)({urlKey:"deleteSecretKey",select:e=>e?j?.find(s=>s.id===e):void 0,enabled:!!j?.length,onError:(e,s)=>(0,Q.handleErrorOnDelete)(f,s,"API Key not found")}),{mutate:w,isPending:P}=z({onSuccess:()=>{y.toast.success("Successfully deleted secret key"),b(null)},onError:()=>{f.current=null}});return(0,s.jsxs)("div",{className:"pb-30",children:[(0,s.jsx)(O.FormHeader,{title:"Secret keys",description:"These API keys allow privileged access to your project's APIs. Use in servers, functions, workers or other backend components of your application.",actions:(0,s.jsx)(eT,{})}),r||a?c||a?(0,s.jsx)(Y.GenericSkeletonLoader,{}):u?(0,s.jsx)(q.AlertError,{error:n,subject:"Failed to load secret API keys"}):g?(0,s.jsx)(o.Card,{children:(0,s.jsxs)("div",{className:"!rounded-b-md overflow-hidden py-12 flex flex-col gap-1 items-center justify-center",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No secret API keys found"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Your project is not accessible via secret keys—there are no active secret keys created."})]})}):(0,s.jsx)(o.Card,{className:"bg-surface-100",children:(0,s.jsxs)(d.Table,{children:[(0,s.jsx)(d.TableHeader,{children:(0,s.jsxs)(d.TableRow,{className:"bg-200",children:[(0,s.jsx)(d.TableHead,{children:"Name"}),(0,s.jsx)(d.TableHead,{children:"API Key"}),p&&(0,s.jsx)(d.TableHead,{className:"hidden lg:table-cell",children:"Last Used"}),(0,s.jsx)(d.TableHead,{})]})}),(0,s.jsx)(d.TableBody,{children:j.map(i=>(0,s.jsx)(ei,{apiKey:i,lastSeen:h?.[i.hash],isLoadingLastSeen:m,isDeleting:k?.id===i.id&&P,onDelete:()=>e?i.id?void(f.current=i.id,w({projectRef:e,id:i.id})):console.error("API key ID is required"):console.error("Project ref is required"),setKeyToDelete:b,isDeleteModalOpen:k?.id===i.id},i.id))})]})}):(0,s.jsx)(H.NoPermission,{resourceText:"view API keys"})]})};var eI=e.i(580351),eC=e.i(448710),eD=e.i(865389);let eE=(0,x.forwardRef)(({disabled:e,style:i,className:t,...r},a)=>(0,s.jsx)("div",{ref:a,...r,className:(0,A.cn)(e&&"opacity-50 pointer-events-none",t),style:{...e&&{userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},...i}}));eE.displayName="DisableInteraction";let eF=()=>{let{ref:e}=(0,t.useParams)(),{can:r}=(0,v.useAsyncCheckPermissions)(i.PermissionAction.SECRETS_READ,"*"),{data:a=[]}=(0,B.useAPIKeysQuery)({projectRef:e,reveal:!1},{enabled:r}),l=(0,x.useMemo)(()=>a.filter(({type:e})=>"publishable"===e||"secret"===e),[a]).length>0;return(0,s.jsxs)(s.Fragment,{children:[r&&!l&&(0,s.jsx)(L,{}),l&&(0,s.jsx)(R,{}),(0,s.jsxs)(eE,{disabled:!l,className:"flex flex-col gap-8",children:[(0,s.jsx)(eg,{}),(0,s.jsx)(c.Separator,{}),(0,s.jsx)(e_,{})]})]})};eF.getLayout=e=>(0,s.jsx)(eC.DefaultLayout,{children:(0,s.jsx)(eD.default,{children:(0,s.jsx)(eI.default,{children:e})})}),e.s(["default",0,eF],822923)},683038,(e,s,i)=>{let t="/project/[ref]/settings/api-keys";(window.__NEXT_P=window.__NEXT_P||[]).push([t,()=>e.r(822923)]),s.hot&&s.hot.dispose(function(){window.__NEXT_P.push([t])})}]);

//# debugId=ad6f93fa-9bdf-cdfa-aa3c-700a3ad37772
//# sourceMappingURL=553ea924fbd537c3.js.map